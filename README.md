# Сервіс для прогнозування вартості будинку.

Опис завдання на [kaggle.com](https://www.kaggle.com/c/house-prices-advanced-regression-techniques)

## Архітектура

Цей додаток є веб-сервером, який надає RESTful API для взаємодії.
Для взаємодії з цим RESTful API існує [користувацький інтерфейс](https://github.com/bartoshyk/house-prices-ui)

## Потрібні бібліотеки та інструменти

* Python 3.6
* pip 19.0.3
* Flask 1.0.2
* Flask-WTF
* Jinja2 (залежність Flask)
* Flask-SQLAlchemy
* Flask-Migrate
* Flask-Login
* Werkzeug (залежність Flask)
* scikit-learn

## Опис алгоритму обробки даних та прогнозування

Загальні концепції та техніки Machine Learning, які використовуються для підготовки даних та прогнозування вартості будинку.
//TODO

## Налаштувати оточення

Створити віртуальне оточення
```sh
python3 -m venv venv
```

Активувати віртуальне середовище
```sh
source venv/bin/activate
```

Перевірити версію pip, якщо треба оновити версію
```sh
pip install --upgrade pip
```

Встановити Flask у віртуальне середовище
```sh
pip install flask
```

Задати змінну оточення FLASK_APP
```sh
export FLASK_APP=house_prices.py
```
#### Необхідні залежності

Встановити Flask-WTF
```sh
pip install flask-wtf
```
Flask-WTF - це розширення до Flask, для роботи за веб-формами. 
Воно є обгорткою навколо WTForms.

Встановити Flask-SQLAlchemy
```sh
pip install flask-sqlalchemy
```
Flask-SQLAlchemy - це розширення для Flask, 
яке є обгорткою для популярного ORM пакета SQLAlchemy.

Встановити Flask-Migrate
```sh
pip install flask-migrate
```
Flask-Migrate - це розширення для Flask, 
яке є обгорткою для Alembic, основи для міграцію біз даних SQLAlchemy.

Встановити Flask-Login
```sh
pip install flask-login
```

#### Змінні оточення

Перевірити чи ввімкнено режим налагодженя (1 - активовано, 0 - вимкнено)
```sh
echo $FLASK_DEBUG
```

***УВАГА!*** Ніколи не використовуйте режим налагодження в продакшені, цей режим дозволяє віддалено виконувати код на сервері. 

Детальніше про режим налагодженя див. розділ **"Запуск у режимі налагодження"** нище.

Налаштування для SMTP сервера для відправки листів на електронну пошту. Наприклад:
```sh
export MAIL_SERVER=smtp.gmail.com
export MAIL_PORT=587
export MAIL_USE_TLS=1
export MAIL_USERNAME=<your-gmail-username>
export MAIL_PASSWORD=<your-gmail-password>
```

#### Деактивація віртуального оточення

Для деактивації віртуального оточення введіть
```sh
deactivate
```

## Запуск

Активувати попередньо налаштоване віртуальне середовище
```sh
source venv/bin/activate
```

Запустити веб додаток
```sh
flask run
```

Для зупинки додатку натисніть `CTRL+C`

Для деактивації віртуального оточення введіть
```sh
deactivate
```

## Запуск у режимі налагодження

***УВАГА!*** Ніколи не використовуйте режим налагодження в продакшені, цей режим дозволяє віддалено виконувати код на сервері.

Зверніть увагу, що режим налагодження підтримує автоматичний перезапуск сервера у разі змін коду, 
що є доволі зручною функцією в режимі розробки.

Для запуску сервера у режимі налагодження, перед запуском, встановіть наступну змінну оточення
```sh
export FLASK_DEBUG=1
```

Для вимкнення режиму налагодження встановіть цій змінній значення 0
```sh
export FLASK_DEBUG=0
```

Або видаліть змінну з оточення
```sh
unset FLASK_DEBUG
```

Перевірити значення змінної
```sh
echo $FLASK_DEBUG
```

#### Запуск фейкового SMTP серевера

Якщо є потреба, ви можете запустити фейковий SMTP серевера, 
наприклад для пепревірки функції надсилання повідомлень про помилку на адмінську пошту. 

Для цього відкрийте другий сеанс терміналу, та запустіть там цей сервер
```sh
python -m smtpd -n -c DebuggingServer localhost:8025
```

Поверніться в термінал де ви запускаєте основний процес та налаштуйте відповідні змінні оточення
```sh
export MAIL_SERVER=localhost
export MAIL_PORT=8025
```

Переконайтесь, що режим налагодження вимкнено, оскільки в цьому режимі 
повідомлення про помилку з'являтимуться на сторінці у браузері, 
а не надсилатимуться на електронну пошту.

Перезапустіть додаток.


